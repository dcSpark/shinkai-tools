{"type":"Python","content":[{"version":"1.0.0","name":"macos-finder","homepage":null,"author":"@@official.shinkai","py_code":"# /// script\n# dependencies = [\n#   \"requests\",\n# ]\n# ///\n\nfrom typing import Dict, Any, Optional, List\nimport subprocess\nimport os\nfrom dataclasses import dataclass\n\n@dataclass\nclass CONFIG:\n    pass\n\n@dataclass\nclass INPUTS:\n    command: str\n    query: Optional[str] = None  # For searchFiles\n    location: Optional[str] = None  # For searchFiles\n    file_path: Optional[str] = None  # For quickLookFile\n\n@dataclass\nclass OUTPUT:\n    result: str = \"\"\n\nasync def run_applescript(script: str) -> str:\n    \"\"\"Helper function to run AppleScript and return its output.\"\"\"\n    try:\n        result = subprocess.run(['osascript', '-e', script], \n                              capture_output=True, \n                              text=True, \n                              check=True)\n        return result.stdout.strip()\n    except subprocess.CalledProcessError as e:\n        return f\"Error: {e.stderr.strip()}\"\n\nasync def run(config: CONFIG, inputs: INPUTS) -> OUTPUT:\n    output = OUTPUT()\n    script = \"\"\n\n    # Validate inputs first\n    if inputs.command == \"quickLookFile\":\n        if not inputs.file_path:\n            raise ValueError('Missing \"file_path\" for quickLookFile')\n    elif inputs.command == \"searchFiles\":\n        if not inputs.query:\n            raise ValueError('Missing \"query\" for searchFiles')\n\n    if inputs.command == \"getSelectedFiles\":\n        script = \"\"\"\n            tell application \"Finder\"\n                try\n                    set selectedItems to selection\n                    if selectedItems is {} then\n                        return \"No items selected\"\n                    end if\n                    set itemPaths to \"\"\n                    repeat with theItem in selectedItems\n                        set itemPaths to itemPaths & (POSIX path of (theItem as alias)) & linefeed\n                    end repeat\n                    return itemPaths\n                on error errMsg\n                    return \"Failed to get selected files: \" & errMsg\n                end try\n            end tell\n        \"\"\"\n\n    elif inputs.command == \"searchFiles\":\n        search_location = inputs.location or \"~\"\n        # Expand the path before passing it to AppleScript\n        expanded_path = os.path.expanduser(search_location)\n        script = f\"\"\"\n            tell application \"Finder\"\n                try\n                    set searchPath to POSIX file \"{expanded_path}\"\n                    set theFiles to every file of (searchPath as alias) whose name contains \"{inputs.query}\"\n                    set resultList to \"\"\n                    repeat with aFile in theFiles\n                        set resultList to resultList & (POSIX path of (aFile as alias)) & return\n                    end repeat\n                    if resultList is \"\" then\n                        return \"No files found matching '{inputs.query}' in '{search_location}'\"\n                    end if\n                    return resultList\n                on error errMsg\n                    return \"Failed to search files: \" & errMsg\n                end try\n            end tell\n        \"\"\"\n\n    elif inputs.command == \"quickLookFile\":\n        # We can safely use file_path here since we validated it above\n        abs_path = os.path.abspath(os.path.expanduser(inputs.file_path))\n        script = f\"\"\"\n            tell application \"Finder\"\n                try\n                    set targetFile to (POSIX file \"{abs_path}\") as alias\n                    select targetFile\n                    activate\n                    tell application \"System Events\"\n                        keystroke space\n                    end tell\n                    return \"Quick Look preview opened for {inputs.file_path}\"\n                on error errMsg\n                    return \"Failed to open Quick Look: \" & errMsg\n                end try\n            end tell\n        \"\"\"\n\n    else:\n        raise ValueError(f\"Unknown command: {inputs.command}\")\n\n    output.result = await run_applescript(script)\n    return output ","tools":[],"config":[],"description":"Manage files in Finder via AppleScript","keywords":["macos","finder","files","automation","applescript"],"input_args":{"type":"object","properties":{"query":{"type":"string","description":"Search term for searchFiles"},"file_path":{"type":"string","description":"Path for quickLookFile"},"command":{"type":"string","description":"Command to execute: getSelectedFiles to list selected items, searchFiles to find files, quickLookFile to preview"},"location":{"type":"string","description":"Search location (default = ~) for searchFiles"}},"required":["command"]},"output_arg":{"json":""},"activated":false,"embedding":[-0.25724694,-0.4047379,0.3471226,-0.37809652,0.60317165,-0.23180869,-0.2637221,-0.023255385,0.19749206,0.056564067,-0.16371913,0.27167997,-0.4387797,0.0862536,0.27591345,-0.5887705,-0.5314592,-0.43736735,-0.33217216,-0.076635964,0.16446146,1.0666144,-0.13850325,0.15301213,0.24355999,0.31485787,-0.6759498,-0.3001842,-1.4349357,-2.0555809,-0.17455858,0.84460044,0.12729828,0.21991694,0.12134457,-0.16431332,-0.28062758,0.16518554,-0.5822545,-0.48130447,0.21891889,0.37131393,0.316435,-0.24896914,0.29650646,-0.70268464,0.91543037,-0.34051558,0.93465644,0.7694872,-0.8345195,-0.5933414,0.58796203,-0.4220181,-0.18021983,0.3030836,0.045479942,0.04273234,0.02660347,-0.2052125,-0.4705022,-0.054963738,-3.7280207,-0.64062196,0.5342237,0.3869489,0.4794925,0.07257025,0.4175929,0.44076264,-0.16420048,0.2112268,-0.09001407,0.44565398,0.044509955,-1.0452247,-0.4588573,0.11368531,0.6252981,-0.61278427,-0.1362938,0.5518526,-0.5808219,0.39810464,-1.1493478,0.008868501,-0.6783806,-0.5847222,0.05207964,-0.042632964,-0.33766496,0.3679617,0.20569287,0.2327385,0.17729759,0.36071616,-0.27366745,0.24546897,-0.4096456,2.925907,0.82238996,0.18553324,0.54996985,-0.64025223,-0.41078752,-0.5074589,-0.13085453,0.38438743,-0.33479688,0.08913095,-0.20989706,0.2835007,0.0057844073,0.25488263,0.24165726,0.11290385,0.16666283,0.20094635,0.012648899,0.50233096,-0.54291713,0.3171106,-0.9071627,-0.16531068,-1.3165555,-0.43585622,-0.5633611,0.35148677,0.6193063,-0.68677884,0.61487204,-0.31903633,-0.80341744,-0.08117256,0.34582257,0.036400415,-0.25750262,-0.42293993,-0.49155998,-0.21172494,-0.2014527,-1.499331,0.76360995,0.39785343,-0.25849608,0.23037986,0.69182813,-0.24491805,-0.3526061,-0.6045599,-0.81530726,0.34421322,-0.09630155,0.14004478,0.5421193,-0.13307562,-0.92993027,-0.088752195,0.025327869,0.5247015,-0.31118307,-0.19085461,0.93847656,0.73747015,0.3257061,-0.63828284,0.37722868,-0.45719248,0.8180265,-0.01986321,0.3277729,-0.47503415,0.36735675,0.61192125,-0.49899113,0.7588907,-0.92425287,-0.30330747,-0.12045054,-0.5356097,0.54695964,0.31505853,-0.075617805,-0.44167024,-0.20355727,0.32888544,0.8041688,0.13503973,0.39372617,0.75465715,-0.29279602,2.073242,-0.90284044,-0.13768658,0.114514604,0.35230774,0.11609037,0.98945373,-0.06707071,0.13716064,-0.4246949,-0.19230373,0.09544164,0.41984084,0.20818391,-0.12905434,0.80866486,0.22226104,-0.4300568,-0.2867202,0.10201438,0.12801939,0.47486028,0.39971915,-0.10750784,0.62405044,-0.07738662,-0.098731145,0.2890255,0.7477149,0.13990542,0.15274677,-0.9930123,-0.32937798,0.06957224,-0.733258,0.762905,-0.43695426,-0.063261405,-0.18482444,0.095632605,0.54984283,0.62844884,-0.016765341,0.5165183,-0.3363383,-0.15583098,0.20575635,-0.070507854,-1.0397451,0.4075015,-0.06335878,-0.24829215,-0.49276853,-0.11070487,-0.28494465,-0.09833338,-0.1968087,0.32935092,1.4241071,0.49240208,1.1345115,-0.4484514,0.51400125,-0.633153,0.13212195,-1.2029796,0.1907656,-0.045051876,-0.30564976,0.43173444,-0.3112491,0.37730196,0.54786587,-0.6052462,-0.056833666,-0.059622653,-0.18694936,0.5172444,0.20613864,-0.49737927,0.82632303,-0.06783607,-0.10347021,-0.46897537,0.08355072,-0.11965438,-0.35254556,-0.45214742,-0.4401988,-0.44113725,-0.1146278,0.58122605,-0.17574386,-0.37050128,-0.47615907,-0.16995765,-0.16999635,-0.30967566,-0.41717425,-0.5597309,-1.0387206,0.25780228,0.54536134,2.4724653,0.13826571,0.08402247,0.83410144,0.21880591,-0.39752144,0.24241796,-0.3843537,-0.18911837,-0.35156754,-0.88193333,0.15067199,0.7810816,-0.29303512,-0.33354566,1.0743967,-0.30974725,0.85435957,0.6682861,-0.3342116,1.236432,-0.36807713,0.48940897,0.56395376,-0.18222709,-1.6162843,-0.2453478,-0.4698677,0.2612015,-0.41012195,0.088411205,0.69526434,0.39130002,0.22768065,-0.07879169,0.969331,0.9515954,-0.2646948,-0.53708047,-0.5215757,0.85854197,0.5238271,0.4157229,0.5613457,-0.49453637,0.15579255,0.89120775,1.9577408,-0.338372,0.017660404,0.60114706,-0.29720083,-0.75901216,-1.5034672,0.123863004,-0.23153482,-0.47774398,0.6952564,0.43520814,-0.59932554,0.59796023,1.0390893,-0.6503697,0.21176976,-0.717294,1.5545071,-0.19746086,0.058441594,-0.4878535,-0.07577956,0.5181444,-0.11720453,0.6895458,-0.5410997,-0.34101117,0.12497719,-0.08846079,-0.5425931,0.4421579,0.564537,0.15897226,1.2774613,-0.44558594,0.5586281,0.04234381,-0.1025743,0.6545923,0.094678834,-0.40203613,-0.36225802],"result":{"type":"object","properties":{"result":{"description":"Output text from AppleScript","type":"string"}},"required":["result"]},"sql_tables":null,"sql_queries":null,"file_inbox":null,"oauth":null,"assets":null,"runner":"any","operating_system":["linux","macos","windows"],"tool_set":""},false]}