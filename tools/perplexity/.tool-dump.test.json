{"type":"Deno","content":[{"name":"Perplexity","homepage":null,"author":"@@official.shinkai","version":"1.0.0","js_code":"\nimport chromePaths from 'npm:chrome-paths@1.0.1';\nimport TurndownService from 'npm:turndown@7.2.0';\nimport { addExtra } from 'npm:puppeteer-extra@3.3.6';\nimport rebrowserPuppeteer from 'npm:rebrowser-puppeteer@23.10.1';\nimport StealthPlugin from 'npm:puppeteer-extra-plugin-stealth@2.11.2';\n\ntype Configurations = {\n  chromePath?: string;\n};\ntype Parameters = {\n  query: string;\n};\ntype Result = { response: string };\n\nexport type Run<C extends Record<string, any>, I extends Record<string, any>, R extends Record<string, any>> = (config: C, inputs: I) => Promise<R>;\n\nconst puppeteer = addExtra(rebrowserPuppeteer as any);\nconst pluginStealth = StealthPlugin();\n\npluginStealth.enabledEvasions.delete('chrome.loadTimes');\npluginStealth.enabledEvasions.delete('chrome.runtime');\n\npuppeteer.use(pluginStealth);\n\nexport const run: Run<Configurations, Parameters, Result> = async (\n  configurations,\n  params,\n): Promise<Result> => {\n  const chromePath =\n    configurations?.chromePath ||\n    Deno.env.get('CHROME_PATH') ||\n    chromePaths.chrome ||\n    chromePaths.chromium;\n  if (!chromePath) {\n    throw new Error('Chrome path not found');\n  }\n  const browser = await puppeteer.launch({\n    executablePath: chromePath,\n    args: ['--disable-blink-features=AutomationControlled'],\n  });\n  const page = await browser.newPage();\n\n  console.log(\"Navigating to Perplexity's website...\");\n  await page.goto('https://www.perplexity.ai/');\n\n  console.log('Waiting for the page to load...');\n  await page.waitForNetworkIdle({ timeout: 2500 });\n\n  console.log('Filling textarea with query:', params.query);\n  await page.type('textarea', params.query);\n\n  try {\n    console.log('trying to click app popup');\n    await page.click('button:has(svg[data-icon=\"xmark\"])');\n  } catch (_) {\n    console.log('unable to find the x button to close the popup');\n  }\n\n  console.log('Clicking the button with the specified SVG...');\n  await page.click('button:has(svg[data-icon=\"arrow-right\"])');\n\n  console.log('Waiting for the button with the specified SVG to be visible...');\n  await page.waitForSelector('button:has(svg[data-icon=\"arrow-right\"])');\n\n  console.log('Waiting for results to load...');\n  await page.waitForSelector('text=Related');\n\n  console.log('Extracting HTML content...');\n  const htmlContent = await page.evaluate(() => {\n    const resultElements = document.querySelectorAll('div[dir=\"auto\"]');\n    return Array.from(resultElements)\n      .map((element) => element.innerHTML)\n      .join('\\n\\n');\n  });\n\n  console.log('Closing browser...');\n  await browser.close();\n\n  console.log('Converting HTML to Markdown...');\n  const turndownService = new TurndownService();\n  turndownService.addRule('preserveLinks', {\n    filter: 'a',\n    replacement: function (_content: string, node: Element) {\n      const element = node as Element;\n      const href = element.getAttribute('href');\n      return `[${href}](${href})`;\n    },\n  });\n  const markdown = turndownService.turndown(htmlContent);\n\n  const result: Result = {\n    response: markdown,\n  };\n\n  console.log('Returning result:', result);\n  return Promise.resolve({ ...result });\n};\n","tools":[],"config":[{"BasicConfig":{"key_name":"chromePath","description":"Optional path to Chrome executable for browser automation","required":false,"type":null,"key_value":null}}],"description":"Searches the internet using Perplexity","keywords":["perplexity","search"],"input_args":{"type":"object","properties":{"query":{"type":"string","description":"The search query to send to Perplexity"}},"required":["query"]},"output_arg":{"json":""},"activated":false,"embedding":[0.110977024,0.45141035,-0.22621103,-0.73839366,-0.66569847,-0.31065282,-0.46436575,-0.7566426,0.1667947,-0.1629707,-0.4797544,1.1697905,0.52487624,-0.32671282,0.41614112,0.2732951,0.1568219,-0.31578588,-1.1693568,0.539343,0.44237193,0.95825374,0.49016786,0.059257735,0.4595508,-0.1266626,-0.21971467,0.09240231,-0.9244625,-1.95901,0.8332707,-0.035402037,-0.66910744,-0.19510643,0.1861836,-0.74896175,-0.35335997,-0.07804075,-0.58601236,-0.17889635,0.5337802,0.27349943,-0.7119388,0.17112043,-0.16353837,-0.57286483,0.09144518,0.040901445,0.8881004,0.2469415,-0.46033227,-0.22207537,0.101119384,0.5036361,-0.53512615,0.07257283,0.095575824,-0.4892627,-0.45294943,0.26567355,0.3056356,0.7391675,-4.124245,-0.01896253,-0.073930755,0.16979778,0.17980833,-0.37738553,-0.06460192,0.55790734,0.1866517,-0.053921215,-0.24112093,0.3796582,0.12659699,-0.29600048,-0.09610622,-0.071760796,0.05149146,-0.4111525,0.5461365,0.031101018,-0.022535065,-0.018076565,0.12750974,0.22313613,-0.1957128,0.0038962662,0.13298415,0.16826509,-0.16611812,-0.13953725,0.07203346,-0.16827995,-0.3837615,0.061622147,0.45724794,0.40976992,0.54124093,3.4934232,0.5210436,-0.27958888,0.37268105,0.040759567,0.45173663,-0.0924283,-0.10492885,-0.16183156,-0.17369998,-0.076129496,-0.06847698,-0.19875674,0.09101013,0.5059889,-0.29385746,-0.0088841915,0.094699666,0.40071553,0.40991813,0.11015464,-0.76521057,0.6529254,-0.242373,-0.20075738,-0.17936552,0.07580075,-1.1185092,0.27016765,0.44116879,-0.019928018,0.37141103,0.0018014051,-0.53716743,0.32028934,-0.017729454,0.26877978,0.16377993,-0.469709,0.12641262,-0.82514167,0.18262884,-1.1703655,0.8664657,0.11342133,0.8947825,0.7961433,-0.17412767,-0.071389996,-0.5180277,-0.028393395,-0.3576064,0.63728005,-0.046309672,-0.6841276,0.527785,-0.34813526,0.07180974,0.43599373,-0.3724407,0.49021587,-0.34073755,-0.087408625,0.57178354,0.9395102,0.6860182,-0.061857704,0.21753679,-0.2272897,0.37726143,-0.4223989,0.31156868,-0.021819092,-0.27533802,0.5426756,-0.46329278,0.116780296,-0.32852674,0.45712313,-0.03879409,-0.99532163,-0.17527305,0.7517308,-0.12523344,-0.7820304,0.027986802,0.20813407,0.13434884,-0.13795245,0.5918208,0.51871544,-0.6702558,1.6690733,-0.6676787,-0.3809836,0.030475017,0.011550121,-0.20073879,0.31808943,0.115490794,-0.33595,0.057966836,-0.5639761,0.045757085,0.21266335,-0.04119896,-0.69224423,0.7007585,-0.432434,0.5445157,-0.54269814,0.016974775,0.11220923,-0.024178773,0.19408104,0.43770552,-0.07191335,-0.017497398,0.17782195,0.10322357,0.5189725,-0.09310021,-0.072219215,-0.11473365,-0.5251292,-0.701344,-0.20285986,-0.4204037,-0.14125952,-0.16444397,-0.2067886,0.34788606,0.079939,1.1590862,0.5584607,0.89061195,-0.038665645,-0.3988015,0.74298346,0.24514607,-0.906924,0.7279031,-0.108730376,-0.5052251,-0.48092008,0.4195812,-1.0718536,0.17381667,-0.014733531,-0.24340673,1.9078574,0.97720516,-0.05337442,0.3462506,-0.10808912,-0.09447292,0.38402006,-1.4023371,0.03120788,-0.519497,0.58436084,-0.40587917,-0.4480681,0.2578387,-0.306957,0.20576254,0.17248659,-0.68005055,-0.7617563,-0.10644278,-0.49746716,-0.028531365,0.66250485,-0.30359608,0.4068188,0.6908709,-0.0040249396,0.50787115,0.026117712,-0.5721714,-0.049632005,0.25709268,0.28320572,0.739039,-0.089835346,-0.26498985,-0.3371122,-0.40288514,0.08845858,-0.04875935,0.21212035,-0.5365946,0.1202167,-0.28503323,0.06540573,2.3434439,0.52442706,0.9950618,0.35708734,-0.024971133,0.24164142,-0.0024675503,-0.24290478,0.3384783,0.15465873,-0.24039613,-0.3583358,0.48492467,-0.37566948,-0.5859746,-0.7427742,-0.033714246,-0.15926056,0.030271929,-0.2851397,0.51082003,-0.69576013,0.10975328,0.32911056,0.07521139,-2.2029974,-0.32307673,0.6154103,0.3786558,-0.43247128,-0.08517668,0.5010204,-0.30798858,0.38705644,0.18583356,1.8067048,0.5006732,-0.3077378,-0.451505,-0.47177285,0.8022604,-0.4174476,0.051823355,-0.41506773,-0.9942333,-0.28698784,0.33536983,1.4645271,0.535335,0.66993743,-0.09726632,0.18442869,-0.29600212,-1.6375569,0.19774191,0.41653043,-0.39089012,0.5119712,0.060523115,-0.60206085,0.7337946,0.57138455,0.067463085,-0.12759255,-0.1821385,1.439113,0.26482844,-0.1934892,-0.35052425,0.32630876,0.04205793,0.19897152,-0.1018547,-0.63383335,-0.48477942,0.08910653,-0.2049768,-0.38078272,0.25531286,-0.052223798,0.18022618,-0.054611653,0.3274193,0.5763793,-0.15635633,0.49286222,-0.29581112,-0.05556007,-0.7662319,0.22995831],"result":{"type":"object","properties":{"response":{"description":"The search results and analysis from Perplexity","type":"string"}},"required":["response"]},"sql_tables":null,"sql_queries":null,"file_inbox":null,"oauth":null,"assets":null},false]}