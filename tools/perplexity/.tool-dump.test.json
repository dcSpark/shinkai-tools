{"type":"Deno","content":[{"name":"Perplexity","tool_router_key":"local:::__official_shinkai:::perplexity","homepage":null,"author":"@@official.shinkai","version":"1.0.0","mcp_enabled":null,"js_code":"\nimport chromePaths from 'npm:chrome-paths@1.0.1';\nimport TurndownService from 'npm:turndown@7.2.0';\nimport { addExtra } from 'npm:puppeteer-extra@3.3.6';\nimport rebrowserPuppeteer from 'npm:rebrowser-puppeteer@23.10.1';\nimport StealthPlugin from 'npm:puppeteer-extra-plugin-stealth@2.11.2';\n\ntype Configurations = {\n  chromePath?: string;\n};\ntype Parameters = {\n  query: string;\n};\ntype Result = { response: string };\n\nexport type Run<C extends Record<string, any>, I extends Record<string, any>, R extends Record<string, any>> = (config: C, inputs: I) => Promise<R>;\n\nconst puppeteer = addExtra(rebrowserPuppeteer as any);\nconst pluginStealth = StealthPlugin();\n\npluginStealth.enabledEvasions.delete('chrome.loadTimes');\npluginStealth.enabledEvasions.delete('chrome.runtime');\n\npuppeteer.use(pluginStealth);\n\nexport const run: Run<Configurations, Parameters, Result> = async (\n  configurations,\n  params,\n): Promise<Result> => {\n  const chromePath =\n    configurations?.chromePath ||\n    Deno.env.get('CHROME_PATH') ||\n    chromePaths.chrome ||\n    chromePaths.chromium;\n  if (!chromePath) {\n    throw new Error('Chrome path not found');\n  }\n  const browser = await puppeteer.launch({\n    executablePath: chromePath,\n    args: ['--disable-blink-features=AutomationControlled'],\n  });\n  const page = await browser.newPage();\n\n  console.log(\"Navigating to Perplexity's website...\");\n  await page.goto('https://www.perplexity.ai/');\n\n  console.log('Waiting for the page to load...');\n  await page.waitForNetworkIdle({ timeout: 2500 });\n\n  console.log('Filling textarea with query:', params.query);\n  await page.type('textarea', params.query);\n\n  try {\n    console.log('trying to click app popup');\n    await page.click('button:has(svg[data-icon=\"xmark\"])');\n  } catch (_) {\n    console.log('unable to find the x button to close the popup');\n  }\n\n  console.log('Clicking the button with the specified SVG...');\n  await page.click('button:has(svg[data-icon=\"arrow-right\"])');\n\n  console.log('Waiting for the button with the specified SVG to be visible...');\n  await page.waitForSelector('button:has(svg[data-icon=\"arrow-right\"])');\n\n  console.log('Waiting for results to load...');\n  await page.waitForSelector('text=Related');\n\n  console.log('Extracting HTML content...');\n  const htmlContent = await page.evaluate(() => {\n    const resultElements = document.querySelectorAll('div[dir=\"auto\"]');\n    return Array.from(resultElements)\n      .map((element) => element.innerHTML)\n      .join('\\n\\n');\n  });\n\n  console.log('Closing browser...');\n  await browser.close();\n\n  console.log('Converting HTML to Markdown...');\n  const turndownService = new TurndownService();\n  turndownService.addRule('preserveLinks', {\n    filter: 'a',\n    replacement: function (_content: string, node: Element) {\n      const element = node as Element;\n      const href = element.getAttribute('href');\n      return `[${href}](${href})`;\n    },\n  });\n  const markdown = turndownService.turndown(htmlContent);\n\n  const result: Result = {\n    response: markdown,\n  };\n\n  console.log('Returning result:', result);\n  return Promise.resolve({ ...result });\n};\n","tools":[],"config":[{"BasicConfig":{"key_name":"chromePath","description":"Optional path to Chrome executable for browser automation","required":false,"type":null,"key_value":null}}],"description":"Searches the internet using Perplexity","keywords":["perplexity","search"],"input_args":{"type":"object","properties":{"query":{"type":"string","description":"The search query to send to Perplexity"}},"required":["query"]},"output_arg":{"json":""},"activated":false,"embedding":[0.110970885,0.45137125,-0.2262566,-0.7382837,-0.6655653,-0.3104283,-0.46436536,-0.75645125,0.16690442,-0.16305989,-0.47976622,1.169578,0.5248583,-0.32657638,0.41615027,0.27332497,0.15686803,-0.31571734,-1.1693239,0.53937745,0.44234166,0.95834625,0.49038726,0.059211176,0.45942682,-0.12673587,-0.21970147,0.0923844,-0.92452985,-1.9591292,0.8333612,-0.035421267,-0.6692331,-0.19525714,0.18644363,-0.74900395,-0.35338414,-0.07815437,-0.5860107,-0.17897458,0.53380746,0.2735197,-0.711791,0.1709182,-0.16351753,-0.57278496,0.0915159,0.04086659,0.88808537,0.24685948,-0.46035442,-0.22200885,0.10133779,0.50364923,-0.53486466,0.07249756,0.09560402,-0.48942396,-0.45291516,0.26578647,0.305461,0.739162,-4.124415,-0.018740073,-0.073935464,0.16963919,0.17974962,-0.37744522,-0.0647711,0.55805796,0.18661599,-0.053836606,-0.2412225,0.37978166,0.12669483,-0.29601476,-0.0960975,-0.071613505,0.051592123,-0.4113089,0.54606885,0.031066597,-0.022570116,-0.018190764,0.12759134,0.2230058,-0.1956752,0.003953412,0.13293497,0.16837448,-0.16614826,-0.13943246,0.07194514,-0.16840178,-0.38368434,0.061422344,0.45728242,0.40978888,0.5412605,3.4932923,0.520916,-0.27970687,0.3725973,0.040953945,0.45172858,-0.092319496,-0.10495174,-0.16183239,-0.17368345,-0.07628164,-0.06831055,-0.19874032,0.09111678,0.50581163,-0.2937368,-0.008908671,0.09483269,0.40062708,0.40984026,0.110098355,-0.76511896,0.65282494,-0.242327,-0.20079935,-0.17927939,0.07572721,-1.1185881,0.27029017,0.4410751,-0.020203913,0.3714229,0.0018010028,-0.53700596,0.32027552,-0.017838992,0.26869118,0.16376714,-0.46986052,0.12656796,-0.82500815,0.18275037,-1.1701423,0.8663333,0.1132879,0.8945679,0.7961592,-0.17422163,-0.07135815,-0.51801527,-0.028393917,-0.35774592,0.63734347,-0.04622629,-0.68422556,0.5279427,-0.3479893,0.07182524,0.43590873,-0.3724979,0.49010494,-0.34077564,-0.08744665,0.5715844,0.9395243,0.6858404,-0.06192736,0.2173826,-0.22735065,0.37714016,-0.42238894,0.31139132,-0.021905594,-0.27533802,0.5426538,-0.4633913,0.11687639,-0.3285501,0.45711982,-0.038801122,-0.99544334,-0.17532857,0.7517678,-0.12520255,-0.78189284,0.027896047,0.2081736,0.13412485,-0.1378648,0.59179884,0.5188756,-0.67006457,1.6692997,-0.6677654,-0.3809292,0.030532928,0.0114968605,-0.20063521,0.31805444,0.11556232,-0.3360941,0.05816022,-0.564111,0.04586073,0.21274644,-0.041174404,-0.6923076,0.70080537,-0.43233192,0.5445002,-0.5426748,0.016938746,0.112189874,-0.023907334,0.19426864,0.4375506,-0.072026014,-0.01751791,0.17783177,0.103293434,0.5188986,-0.09292594,-0.07209117,-0.114571914,-0.5252708,-0.70140517,-0.20279606,-0.42039597,-0.14116155,-0.16449027,-0.20669855,0.3477267,0.08006848,1.1588669,0.5585542,0.8906158,-0.038827755,-0.39895594,0.742864,0.24530432,-0.9068722,0.72772837,-0.10880251,-0.50522757,-0.48092538,0.4196233,-1.0718428,0.17385451,-0.014628217,-0.24346887,1.9079235,0.97721636,-0.05331004,0.3462274,-0.10808326,-0.09461116,0.3839526,-1.4025785,0.031177249,-0.5195352,0.5842804,-0.40595695,-0.4480702,0.25774893,-0.3068284,0.20584215,0.17260306,-0.68007666,-0.7616854,-0.10650671,-0.4974551,-0.028521739,0.6625361,-0.30348068,0.40671623,0.6907342,-0.004117092,0.50794494,0.026088782,-0.5719907,-0.04966634,0.25693232,0.28326127,0.739007,-0.08995943,-0.26492903,-0.33732083,-0.40271813,0.08860295,-0.04864604,0.21215802,-0.5365207,0.12035376,-0.28498882,0.0654803,2.3434117,0.52433765,0.99489176,0.35710528,-0.024938917,0.24158947,-0.00263156,-0.24276012,0.33852336,0.15477046,-0.24025114,-0.3581491,0.48490983,-0.3756348,-0.5858484,-0.7426869,-0.033554208,-0.15908037,0.030150067,-0.28512868,0.51078564,-0.6957166,0.10975191,0.32911626,0.07514626,-2.202989,-0.3230846,0.61526245,0.37860292,-0.43245208,-0.08518934,0.50109535,-0.30793643,0.38722077,0.18583743,1.8065273,0.50095123,-0.30792177,-0.45169914,-0.47181973,0.8023083,-0.41744748,0.05192378,-0.41495988,-0.994239,-0.28720462,0.33529806,1.4646547,0.5352701,0.6700611,-0.09738065,0.18441206,-0.29584974,-1.6375065,0.1976853,0.41657472,-0.39093515,0.51216316,0.060477607,-0.60208064,0.73374295,0.571496,0.067569256,-0.12782301,-0.18202111,1.4392163,0.26474276,-0.1937124,-0.35032317,0.3262956,0.041980796,0.19894539,-0.10156646,-0.633941,-0.48474377,0.088803925,-0.20492642,-0.38086239,0.25522733,-0.052030843,0.18015385,-0.05469647,0.32727545,0.5764973,-0.15608868,0.49300545,-0.29559112,-0.05573177,-0.7662262,0.22976758],"result":{"type":"object","properties":{"response":{"description":"The search results and analysis from Perplexity","type":"string"}},"required":["response"]},"sql_tables":null,"sql_queries":null,"file_inbox":null,"oauth":null,"assets":null,"runner":"any","operating_system":["linux","macos","windows"],"tool_set":""},false]}